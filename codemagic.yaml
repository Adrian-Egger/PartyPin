workflows:
  ios_release:
    name: iOS Release (TestFlight)
    integrations:
      app_store_connect: Partypin-ASC

    environment:
      flutter: stable
      xcode: latest

    scripts:
      - name: Flutter packages
        script: flutter pub get
      - name: Fetch signing (App Store)
        script: |
          keychain initialize
          app-store-connect fetch-signing-files "com.adrianegger.partypin" --type IOS_APP_STORE --create
          xcode-project use-profiles
      - name: Build IPA
        script: flutter build ipa --release --build-number ${CM_BUILD_ID}

    artifacts:
      - build/ios/ipa/*.ipa
      - build/ios/ipa/*.dSYM.zip

    publishing:
      app_store_connect:
        auth: integration
        submit_to_testflight: true
